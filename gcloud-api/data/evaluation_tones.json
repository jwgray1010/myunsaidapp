{
  "version": "1.3.1",
  "updated": "2025-09-24",
  "notes": "Expanded raw tone set to 21 labels with calibrated non-zero priors per context to improve attachment- and scenario-specific accuracy. Existing Platt/thresholds/costs preserved.",

  "rawTones": [
    "neutral","positive","supportive","anxious","angry","frustrated","sad","assertive","safety_concern",
    "withdrawn","apologetic","curious","dismissive","defensive","jealous_insecure","catastrophizing",
    "minimization","playful","reflective","logistical","confused_ambivalent","insecure", "risk", "excited"
  ],

  "platt": {
    "meta": { "clipRange": [0.05, 0.95], "fallback": "general", "notes": "Applied post-logit, pre-threshold; clip avoids saturation on short texts." },
    "general":   { "a": 1.00, "b": 0.00 },
    "conflict":  { "a": 1.12, "b": -0.06 },
    "repair":    { "a": 0.95, "b": 0.05 },
    "planning":  { "a": 0.92, "b": 0.05 },
    "escalation":{ "a": 1.15, "b": -0.08 },
    "safety":    { "a": 1.20, "b": -0.10 }
  },

  "thresholds": {
    "primaryToneMin": 0.33,
    "flagForReview":  0.75,
    "low":   0.15,
    "med":   0.38,
    "high":  0.65
  },

  "priors": {
    "general": {
      "neutral": 0.30, "positive": 0.16, "supportive": 0.12, "anxious": 0.09, "angry": 0.06,
      "frustrated": 0.07, "sad": 0.04, "assertive": 0.04,
      "safety_concern": 0.01, "withdrawn": 0.02, "apologetic": 0.02, "curious": 0.02,
      "dismissive": 0.01, "defensive": 0.01, "jealous_insecure": 0.01, "catastrophizing": 0.005,
      "minimization": 0.005, "playful": 0.01, "reflective": 0.01, "logistical": 0.005,
      "confused_ambivalent": 0.005, "insecure": 0.3
    },
    "conflict": {
      "angry": 0.30, "frustrated": 0.20, "anxious": 0.12, "neutral": 0.08, "supportive": 0.08, "sad": 0.05, "positive": 0.03,
      "assertive": 0.04, "withdrawn": 0.03, "defensive": 0.03, "dismissive": 0.02, "catastrophizing": 0.01,
      "minimization": 0.005, "curious": 0.005
    },
    "repair": {
      "supportive": 0.30, "positive": 0.16, "neutral": 0.08, "apologetic": 0.14, "curious": 0.10, "reflective": 0.08,
      "anxious": 0.04, "sad": 0.04, "frustrated": 0.04, "assertive": 0.01, "angry": 0.01
    },
    "planning": {
      "logistical": 0.25, "neutral": 0.40, "assertive": 0.18, "supportive": 0.07, "positive": 0.05,
      "frustrated": 0.02, "anxious": 0.02, "reflective": 0.01
    },
    "escalation": {
      "angry": 0.38, "frustrated": 0.25, "anxious": 0.11, "neutral": 0.06, "supportive": 0.04, "positive": 0.02, "sad": 0.03,
      "catastrophizing": 0.05, "defensive": 0.03, "withdrawn": 0.02, "dismissive": 0.01, "excited": 0.01
    },
    "safety": {
      "safety_concern": 0.58, "anxious": 0.16, "sad": 0.10, "neutral": 0.07, "supportive": 0.04, "angry": 0.01,
      "withdrawn": 0.03, "apologetic": 0.01, "risk": 0.30
    }
  },

  "fallbacks": {
    "contextOrder": ["general", "conflict", "repair", "planning"],
    "onMissingPlatt": "use:general",
    "onMissingPriors": "use:general",
    "telemetry": true
  },

  "costs": {
    "falseNegative": { "safety_concern": 5.0, "angry": 2.0, "escalation": 2.0 },
    "falsePositive": { "angry": 1.5, "safety_concern": 2.0 }
  },

  "riskFloors": {
    "angry":           { "minConfidence": 0.78, "actions": ["show_deescalation_tip"] },
    "safety_concern":  { "minConfidence": 0.60, "actions": ["escalate_safety_flow"] },
    "escalation":      { "minConfidence": 0.70, "actions": ["show_deescalation_tip"] }
  },

  "metricTargets": {
    "eceMax": 0.06,
    "macroF1Min": 0.65,
    "angryRecallMin": 0.80,
    "safetyRecallMin": 0.90
  },

  "drift": {
    "alertIfPriorsShiftBy": 0.20,
    "windowDays": 14,
    "emitByContext": true,
    "emitByLabel": true
  },

  "labels": {
    "angry": "Angry",
    "frustrated": "Frustrated",
    "anxious": "Anxious/Fear",
    "sad": "Sadness",
    "positive": "Positive",
    "supportive": "Supportive",
    "assertive": "Analytical/Assertive",
    "neutral": "Neutral",
    "safety_concern": "Safety Concern",

    "withdrawn": "Withdrawn/Distancing",
    "apologetic": "Apologetic",
    "curious": "Curious",
    "dismissive": "Dismissive",
    "defensive": "Defensive",
    "jealous_insecure": "Jealous/Insecure",
    "catastrophizing": "Catastrophizing",
    "minimization": "Minimization",
    "playful": "Playful",
    "reflective": "Reflective",
    "logistical": "Logistical/Task-Focus",
    "confused_ambivalent": "Confused/Ambivalent"
  },

  "defaults": {
    "primaryToneMinNote": "Minimum posterior for selecting a primary tone label.",
    "noRepeatMs": 90000,
    "cooldown": { "noRepeatMs": 90000, "perCategoryMs": 60000 }
  },

  "nli_thresholds": {
    "default": { "entail_min": 0.55, "contra_max": 0.20 },
    "conflict": { "entail_min": 0.60, "contra_max": 0.18 },
    "romantic": { "entail_min": 0.53, "contra_max": 0.22 },
    "repair": { "entail_min": 0.57, "contra_max": 0.19 },
    "planning": { "entail_min": 0.52, "contra_max": 0.23 },
    "general": { "entail_min": 0.55, "contra_max": 0.20 }
  },

  "notes_calibration": "Context Platt scaling + priors → posterior; thresholds applied after normalization.",

  "tests": [
    {
      "id": "T-001",
      "context": "conflict",
      "text": "You never listen to me and I'm done.",
      "expectPrimary": "angry",
      "minConfidence": 0.55
    },
    {
      "id": "T-002",
      "context": "repair",
      "text": "I hear you. That must have been hard—I'm sorry.",
      "expectPrimary": "supportive",
      "minConfidence": 0.50
    },
    {
      "id": "T-003",
      "context": "planning",
      "text": "Can we reschedule to tomorrow at 3pm?",
      "expectPrimary": "neutral",
      "minConfidence": 0.40
    },
    {
      "id": "T-004",
      "context": "escalation",
      "text": "This happens every time and I'm sick of it!",
      "expectPrimary": "angry",
      "minConfidence": 0.60
    },
    {
      "id": "T-005",
      "context": "safety",
      "text": "I'm scared and don't feel safe right now.",
      "expectPrimary": "safety_concern",
      "minConfidence": 0.70
    },
    {
      "id": "T-006",
      "context": "safety",
      "text": "I’m afraid to be here and I need help.",
      "expectPrimary": "safety_concern",
      "minConfidence": 0.72
    },
    {
      "id": "T-007",
      "context": "escalation",
      "text": "You always do this and I’m done.",
      "expectPrimary": "angry",
      "minConfidence": 0.62
    },
    {
      "id": "T-008",
      "context": "unknown_ctx",
      "text": "Let’s figure this out tomorrow at 3.",
      "expectPrimary": "neutral",
      "minConfidence": 0.35,
      "notes": "Exercises fallback → general"
    }
  ]
}
