{
  "version": "1.0.1",
  "schemaVersion": "1.0",
  "lastUpdated": "2025-09-20",
  "notes": "Production-hardened: pre/post clamps, NaN/inf handling, deterministic blending, per-style caps, and clearer integration hooks. Backward-compatible with 1.0.0 values.",
  "applyOrder": [
    "pre_sanity",
    "tone_offsets",
    "tone_multipliers",
    "context_boosts",
    "intensity_blend",
    "threshold_shift",
    "post_clamp",
    "cap_limits"
  ],
  "blending": {
    "toneOffsetMode": "additive",
    "toneMultiplierMode": "multiplicative",
    "contextMode": "additive",
    "intensityMode": "weighted_average",
    "priority": ["alert","caution","clear"]
  },
  "engine": {
    "nanHandling": "coerce_to_zero",
    "infHandling": "clip_to_max",
    "normalizeFinal": true,
    "range": { "min": 0.0, "max": 1.0 },
    "logitSafeEpsilon": 1e-6
  },
  "defaults": {
    "tone_offsets": { "alert": 0.00, "caution": 0.00, "clear": 0.00 },
    "tone_multipliers": { "alert": 1.00, "caution": 1.00, "clear": 1.00 },
    "category_multipliers": {
      "profanity": 1.00,
      "insult": 1.00,
      "threat": 1.00,
      "escalation": 1.00,
      "uncertainty": 1.00,
      "hedge": 1.00,
      "concern": 1.00,
      "repair": 1.00,
      "boundary": 1.00,
      "solution": 1.00,
      "agreement": 1.00
    },
    "context_boosts": {
      "CTX_CONFLICT": { "alert": 0.00, "caution": 0.00, "clear": 0.00 },
      "CTX_PLANNING": { "alert": 0.00, "caution": 0.00, "clear": 0.00 },
      "CTX_BOUNDARY": { "alert": 0.00, "caution": 0.00, "clear": 0.00 },
      "CTX_REPAIR":   { "alert": 0.00, "caution": 0.00, "clear": 0.00 },
      "CTX_ESCALATION": { "alert": 0.00, "caution": 0.00, "clear": 0.00 },
      "CTX_CONFLICT_PREVENTION": { "alert": 0.00, "caution": 0.00, "clear": 0.00 },
      "CTX_ACCOUNTABILITY": { "alert": 0.00, "caution": 0.00, "clear": 0.00 },
      "CTX_DEFENSIVENESS": { "alert": 0.00, "caution": 0.00, "clear": 0.00 },
      "CTX_ATTACHMENT_ATTUNEMENT": { "alert": 0.00, "caution": 0.00, "clear": 0.00 },
      "CTX_VALIDATION": { "alert": 0.00, "caution": 0.00, "clear": 0.00 },
      "CTX_REASSURANCE_SEEKING": { "alert": 0.00, "caution": 0.00, "clear": 0.00 },
      "CTX_EMOTION_REGULATION": { "alert": 0.00, "caution": 0.00, "clear": 0.00 },
      "CTX_CO_PARENTING": { "alert": 0.00, "caution": 0.00, "clear": 0.00 },
      "CTX_BOUNDARIES": { "alert": 0.00, "caution": 0.00, "clear": 0.00 },
      "CTX_RELATIONSHIP_NURTURE": { "alert": 0.00, "caution": 0.00, "clear": 0.00 },
      "CTX_TRUST_BUILDING": { "alert": 0.00, "caution": 0.00, "clear": 0.00 },
      "CTX_IMPULSE_CONTROL": { "alert": 0.00, "caution": 0.00, "clear": 0.00 },
      "CTX_WITHDRAWAL_IMPULSE": { "alert": 0.00, "caution": 0.00, "clear": 0.00 },
      "CTX_OVERWHELM_GUARDRAIL": { "alert": 0.00, "caution": 0.00, "clear": 0.00 },
      "CTX_TONE_GUARDRAILS": { "alert": 0.00, "caution": 0.00, "clear": 0.00 },
      "CTX_CLARITY": { "alert": 0.00, "caution": 0.00, "clear": 0.00 },
      "CTX_BREVITY": { "alert": 0.00, "caution": 0.00, "clear": 0.00 },
      "CTX_TIMING": { "alert": 0.00, "caution": 0.00, "clear": 0.00 },
      "CTX_FORMAT_HYGIENE": { "alert": 0.00, "caution": 0.00, "clear": 0.00 },
      "CTX_TONE_MANAGEMENT": { "alert": 0.00, "caution": 0.00, "clear": 0.00 }
    },
    "intensity_blend": { "weight": 0.20 },
    "threshold_shift": { "alert": 0.00, "caution": 0.00, "clear": 0.00 },
    "cap_limits": {
      "per_tone_offset_max": 0.35,
      "per_tone_multiplier_max": 1.40,
      "per_style_offset_budget": 0.40,
      "per_style_multiplier_budget": 0.20
    }
  },
  "overrides": {
    "anxious": {
      "tone_offsets": { "alert": -0.03, "caution": 0.08, "clear": 0.00 },
      "tone_multipliers": { "alert": 0.98, "caution": 1.06, "clear": 1.00 },
      "category_multipliers": { "uncertainty": 1.08, "hedge": 1.06, "concern": 1.04, "repair": 1.03, "escalation": 1.02 },
      "context_boosts": {
        "CTX_CONFLICT": { "alert": -0.02, "caution": 0.03, "clear": 0.00 },
        "CTX_REPAIR":   { "alert": -0.01, "caution": 0.04, "clear": 0.02 },
        "CTX_ESCALATION": { "alert": 0.02, "caution": 0.01, "clear": -0.01 },
        "CTX_CONFLICT_PREVENTION": { "alert": -0.02, "caution": 0.02, "clear": 0.01 },
        "CTX_ACCOUNTABILITY": { "alert": 0.01, "caution": 0.02, "clear": -0.01 },
        "CTX_DEFENSIVENESS": { "alert": 0.02, "caution": 0.01, "clear": -0.01 },
        "CTX_ATTACHMENT_ATTUNEMENT": { "alert": -0.01, "caution": 0.01, "clear": 0.02 },
        "CTX_VALIDATION": { "alert": -0.02, "caution": 0.01, "clear": 0.03 },
        "CTX_REASSURANCE_SEEKING": { "alert": 0.01, "caution": 0.03, "clear": -0.01 },
        "CTX_EMOTION_REGULATION": { "alert": -0.01, "caution": 0.02, "clear": 0.01 },
        "CTX_RELATIONSHIP_NURTURE": { "alert": -0.01, "caution": 0.01, "clear": 0.02 },
        "CTX_TRUST_BUILDING": { "alert": 0.01, "caution": 0.02, "clear": 0.01 },
        "CTX_WITHDRAWAL_IMPULSE": { "alert": 0.02, "caution": 0.02, "clear": -0.02 },
        "CTX_OVERWHELM_GUARDRAIL": { "alert": 0.01, "caution": 0.02, "clear": -0.01 }
      },
      "intensity_blend": { "weight": 0.25 },
      "threshold_shift": { "alert": 0.01, "caution": -0.02, "clear": 0.00 },
      "caps": { "offset_budget": 0.40, "multiplier_budget": 0.20 }
    },
    "avoidant": {
      "tone_offsets": { "alert": 0.00, "caution": 0.03, "clear": 0.08 },
      "tone_multipliers": { "alert": 0.99, "caution": 1.02, "clear": 1.06 },
      "category_multipliers": { "boundary": 1.04, "solution": 1.03, "agreement": 1.02, "escalation": 0.98 },
      "context_boosts": {
        "CTX_PLANNING": { "alert": 0.00, "caution": 0.02, "clear": 0.03 },
        "CTX_BOUNDARY": { "alert": 0.00, "caution": 0.02, "clear": 0.03 },
        "CTX_ESCALATION": { "alert": -0.01, "caution": 0.01, "clear": 0.02 },
        "CTX_CONFLICT_PREVENTION": { "alert": 0.00, "caution": 0.01, "clear": 0.02 },
        "CTX_ACCOUNTABILITY": { "alert": 0.00, "caution": 0.01, "clear": 0.02 },
        "CTX_ATTACHMENT_ATTUNEMENT": { "alert": -0.01, "caution": 0.00, "clear": 0.02 },
        "CTX_VALIDATION": { "alert": -0.01, "caution": 0.00, "clear": 0.02 },
        "CTX_EMOTION_REGULATION": { "alert": 0.00, "caution": 0.01, "clear": 0.02 },
        "CTX_BOUNDARIES": { "alert": 0.00, "caution": 0.01, "clear": 0.03 },
        "CTX_RELATIONSHIP_NURTURE": { "alert": -0.01, "caution": 0.01, "clear": 0.02 },
        "CTX_TRUST_BUILDING": { "alert": 0.00, "caution": 0.01, "clear": 0.02 },
        "CTX_WITHDRAWAL_IMPULSE": { "alert": -0.01, "caution": 0.00, "clear": 0.02 },
        "CTX_CLARITY": { "alert": 0.00, "caution": 0.01, "clear": 0.02 },
        "CTX_BREVITY": { "alert": 0.00, "caution": 0.01, "clear": 0.02 }
      },
      "intensity_blend": { "weight": 0.18 },
      "threshold_shift": { "alert": 0.01, "caution": 0.00, "clear": -0.02 },
      "caps": { "offset_budget": 0.40, "multiplier_budget": 0.20 }
    },
    "disorganized": {
      "tone_offsets": { "alert": 0.06, "caution": 0.06, "clear": 0.00 },
      "tone_multipliers": { "alert": 1.05, "caution": 1.04, "clear": 1.00 },
      "category_multipliers": { "escalation": 1.04, "threat": 1.03, "uncertainty": 1.03, "repair": 1.02 },
      "context_boosts": {
        "CTX_CONFLICT": { "alert": 0.03, "caution": 0.02, "clear": 0.00 },
        "CTX_REPAIR":   { "alert": 0.00, "caution": 0.02, "clear": 0.01 },
        "CTX_ESCALATION": { "alert": 0.03, "caution": 0.01, "clear": -0.02 },
        "CTX_DEFENSIVENESS": { "alert": 0.02, "caution": 0.02, "clear": -0.01 },
        "CTX_ATTACHMENT_ATTUNEMENT": { "alert": 0.01, "caution": 0.02, "clear": 0.00 },
        "CTX_VALIDATION": { "alert": 0.01, "caution": 0.01, "clear": 0.01 },
        "CTX_REASSURANCE_SEEKING": { "alert": 0.02, "caution": 0.03, "clear": -0.01 },
        "CTX_EMOTION_REGULATION": { "alert": 0.01, "caution": 0.02, "clear": 0.00 },
        "CTX_WITHDRAWAL_IMPULSE": { "alert": 0.03, "caution": 0.02, "clear": -0.02 },
        "CTX_OVERWHELM_GUARDRAIL": { "alert": 0.02, "caution": 0.03, "clear": -0.01 },
        "CTX_IMPULSE_CONTROL": { "alert": 0.01, "caution": 0.02, "clear": 0.01 }
      },
      "intensity_blend": { "weight": 0.28 },
      "threshold_shift": { "alert": -0.01, "caution": -0.01, "clear": 0.00 },
      "caps": { "offset_budget": 0.40, "multiplier_budget": 0.20 }
    },
    "secure": {
      "tone_offsets": { "alert": 0.00, "caution": 0.00, "clear": 0.10 },
      "tone_multipliers": { "alert": 1.00, "caution": 1.00, "clear": 1.08 },
      "category_multipliers": { "repair": 1.06, "solution": 1.04, "agreement": 1.03, "boundary": 1.03, "escalation": 0.96 },
      "context_boosts": {
        "CTX_REPAIR":   { "alert": -0.02, "caution": 0.02, "clear": 0.04 },
        "CTX_PLANNING": { "alert": 0.00, "caution": 0.00, "clear": 0.02 },
        "CTX_CONFLICT_PREVENTION": { "alert": -0.01, "caution": 0.00, "clear": 0.02 },
        "CTX_ACCOUNTABILITY": { "alert": -0.01, "caution": 0.01, "clear": 0.02 },
        "CTX_ATTACHMENT_ATTUNEMENT": { "alert": -0.01, "caution": 0.00, "clear": 0.03 },
        "CTX_VALIDATION": { "alert": -0.02, "caution": 0.00, "clear": 0.03 },
        "CTX_EMOTION_REGULATION": { "alert": -0.01, "caution": 0.01, "clear": 0.02 },
        "CTX_RELATIONSHIP_NURTURE": { "alert": -0.01, "caution": 0.01, "clear": 0.03 },
        "CTX_TRUST_BUILDING": { "alert": -0.01, "caution": 0.01, "clear": 0.03 },
        "CTX_CLARITY": { "alert": 0.00, "caution": 0.00, "clear": 0.02 },
        "CTX_TONE_MANAGEMENT": { "alert": -0.01, "caution": 0.01, "clear": 0.02 }
      },
      "intensity_blend": { "weight": 0.15 },
      "threshold_shift": { "alert": 0.02, "caution": 0.00, "clear": -0.02 },
      "caps": { "offset_budget": 0.40, "multiplier_budget": 0.20 }
    }
  },
  "integration": {
    "scoreFormula": "final_tone = normalize( clamp(((base_tone + tone_offsets) * tone_multipliers) + context_boosts + w*intensity, [0,1]) )",
    "variables": { "w": "intensity_blend.weight", "intensity": "external_intensity_signal_in_[0,1]" },
    "priority": ["alert","caution","clear"],
    "conflicts": {
      "whenEqual": "prefer_caution",
      "minDeltaToFlip": 0.02
    }
  },
  "guards": {
    "offsetClamp": { "min": -0.35, "max": 0.35 },
    "multiplierClamp": { "min": 0.80, "max": 1.40 },
    "thresholdClamp": { "min": -0.10, "max": 0.10 },
    "perStyleBudgets": {
      "offset_budget": 0.40,
      "multiplier_budget": 0.20,
      "applyMode": "saturated_additive"
    }
  },
  "telemetry": {
    "logAppliedLayers": true,
    "fields": ["style","offsets","multipliers","context_boosts","intensity_weight","threshold_shift","clampsApplied"],
    "privacy": { "pii": "strip", "rawUserText": "hash+windowed", "retentionDays": 14 }
  },
  "validation": {
    "tests": [
      {
        "id": "ANX-tilt-caution",
        "base": { "alert": 0.30, "caution": 0.32, "clear": 0.28 },
        "style": "anxious",
        "intensity": 0.5,
        "expectTop": "caution"
      },
      {
        "id": "SEC-tilt-clear",
        "base": { "alert": 0.28, "caution": 0.30, "clear": 0.31 },
        "style": "secure",
        "intensity": 0.4,
        "expectTop": "clear"
      },
      {
        "id": "DIS-escalation-safe-clamp",
        "base": { "alert": 0.55, "caution": 0.30, "clear": 0.15 },
        "style": "disorganized",
        "intensity": 0.8,
        "assert": "within_range_[0,1]"
      }
    ]
  }
}
