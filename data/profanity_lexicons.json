{
  "version": "1.3.1",
  "notes": "Profanity sensitivity with mild/moderate/strong tiers, streaming partial-token support, robust normalization, hard-floor alert for strong + second-person targeting, and profile-aware adjustments for habitual use.",
  "metadata": {
    "schema": "unsaid.profanity.rules/1.3.x",
    "updatedAt": "2025-09-18T00:00:00Z",
    "compat": ["1.3.0"]
  },
  "selfTest": {
    "cases": [
      { "text": "You're an idiot, shut up.", "expect": { "tone": "alert" } },
      { "text": "lol that was dumb jk", "expect": { "toneMax": "caution" } },
      { "text": "I'm such an idiot 😂", "expect": { "toneMax": "caution" }, "context": { "selfDirected": true } },
      { "text": "\"fuck\" (example only)", "expect": { "toneMax": "caution" }, "context": { "exampleMode": true } },
      { "text": "You're such a slut", "expect": { "tone": "alert" } },
      { "text": "I'll make you regret this", "expect": { "tone": "alert" } },
      { "text": "That's so cringe lol", "expect": { "toneMax": "caution" } },
      { "text": "Whatever.", "expect": { "tone": "caution" } },
      { "text": "Fine. Good for you.", "expect": { "tone": "caution" } },
      { "text": "You're toxic ngl but love you bestie 💕", "expect": { "toneMax": "caution" } },
      { "text": "I fucking h", "expect": { "alertMin": 0.80 }, "streaming": true },
      { "text": "I fucking hate you!", "expect": { "tone": "alert" } }
    ]
  },
  "defaultSensitivity": "medium",
  "weightMap": {
    "low":    { "mild": 0.20, "moderate": 0.40, "strong": 0.60 },
    "medium": { "mild": 0.40, "moderate": 0.70, "strong": 1.00 },
    "high":   { "mild": 0.60, "moderate": 1.00, "strong": 1.40 }
  },
  "streaming": {
    "enabled": true,
    "partialTokenMatch": true,
    "minChars": 1,
    "debounceMs": 0,
    "provisionalDecayMs": 1200
  },
  "normalization": {
    "nfkc": true,
    "lower": true,
    "collapseWhitespace": true,
    "collapseElongation": { "enabled": true, "maxRepeat": 3 },
    "stripDiacritics": true,
    "apostrophes": ["'", "’", "`"],
    "map": {
      "f*ck": "fuck", "f**k": "fuck", "f#ck": "fuck", "f@ck": "fuck",
      "f-ck": "fuck", "f—ck": "fuck", "f’ing": "fucking", "f'ing": "fucking",
      "effing": "fucking", "fkn": "fucking", "fuc*": "fuck",
      "sh*t": "shit", "bi*ch": "bitch", "a**hole": "asshole", "d*ck": "dick"
    }
  },
  "hardFloor": {
    "respectHardFloor": true,
    "locks": ["RULE_PROF_HARDFLOOR_STRONG_TARGETED"]
  },

  "profiles": {
    "high_sensitivity": {
      "weightMultiplier": 1.15,
      "negationPenalty": 1.10,
      "sarcasmPenalty": 1.10
    },
    "low_reactivity": {
      "weightMultiplier": 0.90
    },
    "habitual_swearer": {
      "weightMultiplier": 0.70,
      "deescalationBias": 0.10,
      "repeatTolerance": 2,
      "notes": "For users whose baseline includes casual profanity; reduces over-flagging.",
      "cannotOverrideHardFloors": true
    }
  },

  "categories": [
    {
      "id": "PROF_MILD",
      "severity": "mild",
      "tone": "caution",
      "triggerWords": ["crap", "hell", "damn"],
      "attachmentStyles": ["anxious", "avoidant", "disorganized", "secure"],
      "styleWeight": { "anxious": 0.05, "avoidant": 0.03, "disorganized": 0.04, "secure": 0.00 },
      "toneWeight": { "alert": 0.10, "caution": 0.15, "clear": 0.00 },
      "spacyPatterns": [
        [{ "LOWER": "crap" }],
        [{ "LOWER": "hell" }],
        [{ "LOWER": "damn" }]
      ]
    },
    {
      "id": "PROF_MODERATE",
      "severity": "moderate",
      "tone": "caution",
      "triggerWords": [
        "jerk","idiot","stupid","dumb","moron","loser","clown","trash",
        "screw off","shut up","hate","hating","hatred","despise",
        "worst","terrible","awful","horrible","disgusting","revolting","can't stand"
      ],
      "semanticVariants": ["act your age","grow up","what a joke","you’re ridiculous","you're ridiculous"],
      "attachmentStyles": ["anxious", "avoidant", "disorganized", "secure"],
      "styleWeight": { "anxious": 0.10, "avoidant": 0.07, "disorganized": 0.09, "secure": 0.03 },
      "toneWeight": { "alert": 0.15, "caution": 0.12, "clear": -0.02 },
      "spacyPatterns": [
        [{ "LOWER": "jerk" }],
        [{ "LOWER": "idiot" }],
        [{ "LOWER": "stupid" }],
        [{ "LOWER": "dumb" }],
        [{ "LOWER": "moron" }],
        [{ "LOWER": "loser" }],
        [{ "LOWER": "clown" }],
        [{ "LOWER": "trash" }],
        [{ "LOWER": "screw" }, { "LOWER": "off" }],
        [{ "LOWER": "shut" }, { "LOWER": "up" }],
        [{ "LOWER": "hate" }],
        [{ "LOWER": "hatred" }],
        [{ "LOWER": "despise" }],
        [{ "LOWER": "worst" }],
        [{ "LOWER": "terrible" }],
        [{ "LOWER": "awful" }],
        [{ "LOWER": "horrible" }],
        [{ "LOWER": "disgusting" }],
        [{ "LOWER": "revolting" }],
        [{ "LOWER": "can't" }, { "LOWER": "stand" }]
      ],
      "escalationHints": {
        "intensityBoostThreshold": 0.20,
        "positionBoost": { "start": 0.02, "caps": 0.03, "repeat": 0.04 },
        "cooccursToAlert": ["always","never","you","every","done","fed up"]
      }
    },
    {
      "id": "PROF_STRONG",
      "severity": "strong",
      "tone": "alert",
      "triggerWords": [
        "fuck","fck","fuk","fucc","fkn","f-ing","f'ing","fucking","effing",
        "shit","bitch","asshole","dick","piss off"
      ],
      "semanticVariants": ["screw you","get lost","eat shit","eff you"],
      "partialTokens": ["fuc","fucki","fuckin","shi","bitch","assh"],
      "windowMatch": { "charsBefore": 0, "charsAfter": 4 },
      "attachmentStyles": ["anxious", "avoidant", "disorganized", "secure"],
      "styleWeight": { "anxious": 0.15, "avoidant": 0.10, "disorganized": 0.12, "secure": 0.08 },
      "toneWeight": { "alert": 0.25, "caution": 0.05, "clear": -0.05 },
      "spacyPatterns": [
        [{ "LOWER": "fuck" }],
        [{ "LOWER": "shit" }],
        [{ "LOWER": "bitch" }],
        [{ "LOWER": "asshole" }],
        [{ "LOWER": "dick" }],
        [{ "LOWER": "piss" }, { "LOWER": "off" }]
      ],
      "normalization": {
        "map": { "f*ck": "fuck", "f**k": "fuck", "f#ck": "fuck", "f@ck": "fuck", "f-ck": "fuck", "f—ck": "fuck" }
      }
    },
    {
      "id": "PROF_DISCRIMINATORY",
      "severity": "strong",
      "tone": "alert",
      "triggerWords": [
        "retarded","gay","homo","fag","tranny","dyke","slut","whore",
        "cunt","pussy","cocksucker","motherfucker","bastard","son of a bitch"
      ],
      "semanticVariants": ["that's so gay","you're such a slut","acting like a whore"],
      "partialTokens": ["retard","fagg","homo"],
      "attachmentStyles": ["anxious", "avoidant", "disorganized", "secure"],
      "styleWeight": { "anxious": 0.20, "avoidant": 0.15, "disorganized": 0.18, "secure": 0.12 },
      "toneWeight": { "alert": 0.35, "caution": 0.00, "clear": -0.10 },
      "spacyPatterns": [
        [{ "LOWER": "retarded" }],
        [{ "LOWER": "gay" }],
        [{ "LOWER": "slut" }],
        [{ "LOWER": "whore" }],
        [{ "LOWER": "cunt" }]
      ],
      "escalationHints": {
        "intensityBoostThreshold": 0.15,
        "positionBoost": { "start": 0.03, "caps": 0.04, "repeat": 0.05 },
        "cooccursToAlert": ["you're","such a","acting like","being a"]
      },
      "notes": "Discriminatory language that targets identity, sexuality, or uses derogatory slurs"
    },
    {
      "id": "PROF_THREATS",
      "severity": "strong", 
      "tone": "alert",
      "triggerWords": [
        "kill","murder","die","suicide","hurt","harm","destroy","ruin",
        "regret","pay for this","make you suffer","get back at you","revenge"
      ],
      "semanticVariants": ["gonna make you pay","you'll be sorry","I'll ruin you","wish you were dead"],
      "attachmentStyles": ["anxious", "avoidant", "disorganized", "secure"],
      "styleWeight": { "anxious": 0.25, "avoidant": 0.20, "disorganized": 0.25, "secure": 0.15 },
      "toneWeight": { "alert": 0.40, "caution": 0.00, "clear": -0.15 },
      "spacyPatterns": [
        [{ "LOWER": "kill" }],
        [{ "LOWER": "murder" }],
        [{ "LOWER": "destroy" }],
        [{ "LOWER": "ruin" }],
        [{ "LEMMA": "regret" }]
      ],
      "escalationHints": {
        "intensityBoostThreshold": 0.10,
        "positionBoost": { "start": 0.04, "caps": 0.05, "repeat": 0.06 },
        "cooccursToAlert": ["I'll","gonna","going to","will","you'll"]
      },
      "hardFloorOverride": true,
      "notes": "Threatening language that implies harm, violence, or retaliation"
    },
    {
      "id": "PROF_TOXIC_MODERN",
      "severity": "moderate",
      "tone": "caution",
      "triggerWords": [
        "toxic","cringe","pathetic","embarrassing","cringe","cringy",
        "sus","shady","sketchy","problematic","yikes","oof",
        "simp","karen","boomer","ok boomer","snowflake","triggered",
        "cope","seethe","ratio","L","take the L","touch grass","no cap"
      ],
      "semanticVariants": ["that's cringe","so toxic","you're sus","ok karen","get ratioed"],
      "attachmentStyles": ["anxious", "avoidant", "disorganized", "secure"],
      "styleWeight": { "anxious": 0.12, "avoidant": 0.08, "disorganized": 0.10, "secure": 0.05 },
      "toneWeight": { "alert": 0.12, "caution": 0.18, "clear": -0.03 },
      "spacyPatterns": [
        [{ "LOWER": "toxic" }],
        [{ "LOWER": "cringe" }],
        [{ "LOWER": "pathetic" }],
        [{ "LOWER": "karen" }],
        [{ "LOWER": "simp" }]
      ],
      "escalationHints": {
        "intensityBoostThreshold": 0.18,
        "positionBoost": { "start": 0.02, "caps": 0.03, "repeat": 0.03 },
        "cooccursToAlert": ["you're","such a","being","acting"]
      },
      "notes": "Modern internet vernacular that can be dismissive or belittling in context"
    },
    {
      "id": "PROF_PASSIVE_AGGRESSIVE",
      "severity": "mild",
      "tone": "caution", 
      "triggerWords": [
        "whatever","fine","sure","ok","okay","thanks a lot","great job",
        "good for you","bless your heart","how nice","interesting",
        "noted","good to know","if you say so","I'm sure"
      ],
      "semanticVariants": ["well that's great","how wonderful","good luck with that"],
      "contextualTriggers": {
        "sarcasmMarkers": ["period_ending","short_response","emoji_mismatch"],
        "requiresContext": true,
        "minWordThreshold": 1,
        "maxWordThreshold": 4
      },
      "attachmentStyles": ["anxious", "avoidant", "disorganized", "secure"],
      "styleWeight": { "anxious": 0.08, "avoidant": 0.12, "disorganized": 0.10, "secure": 0.03 },
      "toneWeight": { "alert": 0.05, "caution": 0.12, "clear": -0.02 },
      "spacyPatterns": [
        [{ "LOWER": "whatever" }],
        [{ "LOWER": "fine" }],
        [{ "LOWER": "sure" }],
        [{ "LOWER": "noted" }]
      ],
      "escalationHints": {
        "intensityBoostThreshold": 0.25,
        "positionBoost": { "start": 0.01, "caps": 0.02, "repeat": 0.02 },
        "cooccursToAlert": ["you","your","that"]
      },
      "notes": "Passive-aggressive responses that can signal dismissiveness or hostility"
    }
  ],

  "exemptions": {
    "quotedText": true,
    "selfDirected": true,
    "exampleMode": true,
    "notes": "If profanity is inside quotes, aimed at self (\"I’m such an idiot\"), or clearly instructional/example text, downweight or ignore."
  },

  "softeners": {
    "hedges": ["jk","j/k","lol","lmao","haha","kidding","just kidding","playin","no offense","my bad","sorry"],
    "emojis": ["😊","😅","😂","🥲","🙏","✌️","💛","❤️","💕","🫶","😘","🙃","😉"],
    "positiveValence": ["thank you","appreciate","grateful","love this","so proud","nice work","good job","amazing","awesome","wonderful"],
    "relationshipContext": ["bff","bestie","bro","sis","fam","love you","honey","babe","sweetie"],
    "modernSofteners": ["ngl","tbh","fr","no cap","deadass","lowkey","highkey","periodt","queen","king","bestie"],
    "repairAttempts": ["I didn't mean","sorry if","let me clarify","what I meant was","I'm just saying"],
    "vulnerabilityMarkers": ["I feel","I'm struggling","this is hard","I need","can you help"],
    "notes": "Presence of these cues reduces perceived aggression unless overridden by explicit-target or threat patterns."
  },

  "rules": [
    {
      "id": "RULE_PROF_HARDFLOOR_STRONG_TARGETED",
      "description": "Strong profanity with explicit second-person targeting forces Alert.",
      "applyTo": ["PROF_STRONG"],
      "conditions": {
        "targeting": { "explicitSecondPerson": true, "windowTokens": 4 },
        "exemptionsAllowed": []
      },
      "action": {
        "flipTone": "alert",
        "boostWeight": 0.35,
        "lockFloor": true
      }
    },
    {
      "id": "RULE_PROF_STREAMING_PARTIAL_STRONG",
      "description": "When streaming, partial strong profanity triggers provisional Alert.",
      "applyTo": ["PROF_STRONG"],
      "conditions": {
        "streaming": true,
        "partialMatch": true
      },
      "action": {
        "flipTone": "alert",
        "boostWeight": 0.25,
        "provisional": true,
        "ttlMs": 1200
      }
    },
    {
      "id": "RULE_PROF_ESCALATE_MODERATE",
      "description": "Escalate moderate profanity to alert if intensity boost crosses threshold.",
      "applyTo": ["PROF_MODERATE"],
      "conditions": {
        "minIntensityScore": 0.20,
        "repeatCount": 2,
        "positionBoost": ["start","caps","repeat"],
        "cooccurrence": ["always","never","you"]
      },
      "action": {
        "flipTone": "alert",
        "boostWeight": 0.15
      }
    },
    {
      "id": "RULE_PROF_DEESCALATE_MODERATE",
      "description": "De-escalate moderate profanity when softened by hedges/emojis/positive valence or informal relational context.",
      "applyTo": ["PROF_MODERATE"],
      "conditions": {
        "maxIntensityScore": 0.18,
        "softeners": { "minCount": 1, "lists": ["hedges","emojis","positiveValence","relationshipContext"] },
        "targeting": { "explicitSecondPerson": false, "threatDetected": false },
        "exemptionsAllowed": ["selfDirected","quotedText","exampleMode"]
      },
      "action": {
        "flipTone": "caution",
        "reduceWeight": 0.10
      }
    },
    {
      "id": "RULE_PROF_PROFILE_HABITUAL",
      "description": "Adjust thresholds and weights for habitual-swearer profile to avoid over-flagging casual profanity (cannot override hard floors).",
      "applyTo": ["PROF_MILD","PROF_MODERATE","PROF_STRONG"],
      "conditions": { "profile": "habitual_swearer" },
      "action": {
        "weightMultiplier": 0.70,
        "intensityThresholdShift": 0.05,
        "deescalationBias": 0.10,
        "repeatTolerance": 2,
        "respectHardFloor": true
      }
    },
    {
      "id": "RULE_PROF_DEESCALATE_STRONG_SOFTENED",
      "description": "If strong profanity appears but is clearly non-targeted and softened (humor, camaraderie, self-directed), reduce weight without fully flipping tone.",
      "applyTo": ["PROF_STRONG"],
      "conditions": {
        "targeting": { "explicitSecondPerson": false, "threatDetected": false },
        "softeners": { "minCount": 2, "lists": ["hedges","emojis","relationshipContext"] },
        "context": { "selfDirected": true, "orQuoted": true }
      },
      "action": { "reduceWeight": 0.15 }
    },
    {
      "id": "RULE_PROF_HARDFLOOR_DISCRIMINATORY",
      "description": "Discriminatory language always triggers Alert regardless of context.",
      "applyTo": ["PROF_DISCRIMINATORY"],
      "conditions": {
        "exemptionsAllowed": []
      },
      "action": {
        "flipTone": "alert",
        "boostWeight": 0.40,
        "lockFloor": true
      }
    },
    {
      "id": "RULE_PROF_HARDFLOOR_THREATS", 
      "description": "Threatening language always triggers Alert regardless of context.",
      "applyTo": ["PROF_THREATS"],
      "conditions": {
        "exemptionsAllowed": []
      },
      "action": {
        "flipTone": "alert",
        "boostWeight": 0.45,
        "lockFloor": true
      }
    },
    {
      "id": "RULE_PROF_CONTEXT_PASSIVE_AGGRESSIVE",
      "description": "Passive-aggressive language escalates based on context and brevity.",
      "applyTo": ["PROF_PASSIVE_AGGRESSIVE"],
      "conditions": {
        "maxWordCount": 4,
        "sarcasmDetected": true,
        "targeting": { "explicitSecondPerson": true, "windowTokens": 6 }
      },
      "action": {
        "flipTone": "alert",
        "boostWeight": 0.20
      }
    },
    {
      "id": "RULE_PROF_DEESCALATE_MODERN_SOFTENED",
      "description": "Modern toxic language de-escalated when softened with modern communication patterns.",
      "applyTo": ["PROF_TOXIC_MODERN"],
      "conditions": {
        "softeners": { "minCount": 1, "lists": ["modernSofteners","hedges","emojis"] },
        "targeting": { "explicitSecondPerson": false }
      },
      "action": {
        "flipTone": "caution",
        "reduceWeight": 0.15
      }
    }
  ],

  "engine": {
    "detection": {
      "method": "aho_corasick+regex",
      "scanOrder": ["normalization.map", "triggerWords", "semanticVariants", "partialTokens"],
      "minTokenLen": 2,
      "unicodeAware": true
    },
    "targeting": {
      "secondPersonPronouns": ["you","u","ya","ur","you're","youre","u're"],
      "windowTokens": 4
    },
    "intensity": {
      "positionBoost": { "start": 0.02, "caps": 0.03, "repeat": 0.04 },
      "repeatWindow": 5
    }
    }
  }
