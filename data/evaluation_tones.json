{
  "version": "1.2.1",
  "updated": "2025-09-20",

  "platt": {
    "meta": { "clipRange": [0.05, 0.95], "fallback": "general", "notes": "Applied post-logit, pre-threshold; clip avoids saturation on short texts." },
    "general":   { "a": 1.00, "b": 0.00 },
    "conflict":  { "a": 1.12, "b": -0.06 },
    "repair":    { "a": 0.95, "b": 0.05 },
    "planning":  { "a": 0.92, "b": 0.05 },
    "escalation":{ "a": 1.15, "b": -0.08 },
    "safety":    { "a": 1.20, "b": -0.10 }
  },

  "thresholds": {
    "primaryToneMin": 0.33,
    "flagForReview":  0.75,
    "low":   0.15,
    "med":   0.38,
    "high":  0.65
  },

  "priors": {
    "general":   { "neutral": 0.38, "positive": 0.20, "supportive": 0.12, "anxious": 0.10, "angry": 0.07, "frustrated": 0.08, "sad": 0.03, "assertive": 0.02 },
    "conflict":  { "angry": 0.32, "frustrated": 0.22, "anxious": 0.12, "neutral": 0.12, "supportive": 0.10, "sad": 0.06, "positive": 0.06 },
    "repair":    { "supportive": 0.33, "positive": 0.18, "neutral": 0.18, "frustrated": 0.08, "anxious": 0.10, "sad": 0.08, "angry": 0.05 },
    "planning":  { "neutral": 0.52, "assertive": 0.20, "supportive": 0.10, "positive": 0.08, "frustrated": 0.05, "anxious": 0.05 },
    "escalation":{ "angry": 0.40, "frustrated": 0.26, "anxious": 0.10, "neutral": 0.10, "supportive": 0.06, "positive": 0.04, "sad": 0.04 },
    "safety":    { "safety_concern": 0.60, "anxious": 0.16, "sad": 0.10, "neutral": 0.08, "supportive": 0.04, "angry": 0.02 }
  },

  "fallbacks": {
    "contextOrder": ["general", "conflict", "repair", "planning"],
    "onMissingPlatt": "use:general",
    "onMissingPriors": "use:general",
    "telemetry": true
  },

  "costs": {
    "falseNegative": { "safety_concern": 5.0, "angry": 2.0, "escalation": 2.0 },
    "falsePositive": { "angry": 1.5, "safety_concern": 2.0 }
  },

  "riskFloors": {
    "angry":           { "minConfidence": 0.78, "actions": ["show_deescalation_tip"] },
    "safety_concern":  { "minConfidence": 0.60, "actions": ["escalate_safety_flow"] },
    "escalation":      { "minConfidence": 0.70, "actions": ["show_deescalation_tip"] }
  },

  "metricTargets": {
    "eceMax": 0.06,
    "macroF1Min": 0.65,
    "angryRecallMin": 0.80,
    "safetyRecallMin": 0.90
  },

  "drift": {
    "alertIfPriorsShiftBy": 0.20,
    "windowDays": 14,
    "emitByContext": true,
    "emitByLabel": true
  },

  "labels": {
    "angry": "Angry",
    "frustrated": "Frustrated",
    "anxious": "Anxious/Fear",
    "sad": "Sadness",
    "positive": "Positive",
    "supportive": "Supportive",
    "assertive": "Analytical/Assertive",
    "neutral": "Neutral",
    "safety_concern": "Safety Concern"
  },

  "defaults": {
    "primaryToneMinNote": "Minimum posterior for selecting a primary tone label.",
    "noRepeatMs": 90000,
    "cooldown": { "noRepeatMs": 90000, "perCategoryMs": 60000 }
  },

  "notes_calibration": "Context Platt scaling + priors → posterior; thresholds applied after normalization.",

  "tests": [
    {
      "id": "T-001",
      "context": "conflict",
      "text": "You never listen to me and I'm done.",
      "expectPrimary": "angry",
      "minConfidence": 0.55
    },
    {
      "id": "T-002",
      "context": "repair",
      "text": "I hear you. That must have been hard—I'm sorry.",
      "expectPrimary": "supportive",
      "minConfidence": 0.50
    },
    {
      "id": "T-003",
      "context": "planning",
      "text": "Can we reschedule to tomorrow at 3pm?",
      "expectPrimary": "neutral",
      "minConfidence": 0.40
    },
    {
      "id": "T-004",
      "context": "escalation",
      "text": "This happens every time and I'm sick of it!",
      "expectPrimary": "angry",
      "minConfidence": 0.60
    },
    {
      "id": "T-005",
      "context": "safety",
      "text": "I'm scared and don't feel safe right now.",
      "expectPrimary": "safety_concern",
      "minConfidence": 0.70
    },
    {
      "id": "T-006",
      "context": "safety",
      "text": "I’m afraid to be here and I need help.",
      "expectPrimary": "safety_concern",
      "minConfidence": 0.72
    },
    {
      "id": "T-007",
      "context": "escalation",
      "text": "You always do this and I’m done.",
      "expectPrimary": "angry",
      "minConfidence": 0.62
    },
    {
      "id": "T-008",
      "context": "unknown_ctx",
      "text": "Let’s figure this out tomorrow at 3.",
      "expectPrimary": "neutral",
      "minConfidence": 0.35,
      "notes": "Exercises fallback → general"
    }
  ]
}
