{
  "version": "1.2",
  "notes": "Sarcasm signal pack with scoring & guards. Backward-compatible with prior ids.",
  "settings": {
    "detect": true,
    "blend_weights": { "regex": 0.45, "features": 0.35, "context": 0.20 },
    "fire_threshold": 0.65,
    "cooldown_ms": 800,
    "guards": {
      "ignore_zones": ["code_block", "url", "quote_block>direct", "inline_citation", "username", "hashtag"],
      "max_quote_len": 120,
      "min_token_len": 3
    },
    "features": {
      "caps_ratio_min": 0.35,
      "exclaim_or_qmark_burst": 3,
      "ellipsis": true,
      "slash_s": true,
      "emoji_eye_roll": ["🙄","😒"],
      "banter_softeners": ["lol","lmao","jk","j/k","😉","😅","😂"]
    },
    "multilingual": {
      "enabled": true,
      "locales": ["en","es","fr","de","pt","it"],
      "xlang_penalty": 0.03
    }
  },

  "calibration": {
    "impact_floor": -0.12,
    "impact_cap": -0.5,
    "attach_mod_cap": 0.16,
    "context_mod_cap": 0.20,
    "tone_mod_cap": 0.16
  },

  "sarcasm_indicators": [
    {
      "id": "SARC_AIR_QUOTES",
      "pattern": "\"[^\"]+\"|“[^”]+”|‘[^’]+’",
      "impact": -0.3,
      "description": "air/scare quotes implying the opposite",
      "scopeTokens": 12,
      "applyTo": ["patterns","triggers"],
      "toneAdjustments": { "alert": 0.10, "caution": 0.05 },
      "contextAdjustments": { "conflict": 0.15, "repair": -0.05 },
      "attachmentAdjustments": { "avoidant": 0.10, "disorganized": 0.10 },
      "exceptions": ["direct quotations","titles","nicknames","book/song titles"]
    },
    {
      "id": "SARC_YEAH_RIGHT",
      "pattern": "\\b(yeah\\s+right|as\\s+if|sure\\s+thing)\\b",
      "impact": -0.4,
      "description": "dismissive sarcasm phrases",
      "scopeTokens": 8,
      "applyTo": ["patterns","triggers"],
      "toneAdjustments": { "alert": 0.15, "caution": 0.05 },
      "contextAdjustments": { "conflict": 0.20, "validation": -0.10 },
      "attachmentAdjustments": { "anxious": 0.05, "avoidant": 0.15 },
      "exceptions": []
    },
    {
      "id": "SARC_CONTRASTIVE_YEAH_BECAUSE",
      "pattern": "\\byeah,?\\s+because\\b|\\bright,?\\s+because\\b",
      "impact": -0.32,
      "description": "contrastive ‘yeah/right, because…’",
      "scopeTokens": 10,
      "applyTo": ["patterns"],
      "toneAdjustments": { "alert": 0.12 },
      "contextAdjustments": { "conflict": 0.15 },
      "attachmentAdjustments": { "avoidant": 0.08 },
      "exceptions": []
    },
    {
      "id": "SARC_NICE_JOB_IRONY",
      "pattern": "\\b(nice|great|awesome)\\s+(job|work|one|going)\\b",
      "impact": -0.18,
      "description": "praise words used ironically",
      "scopeTokens": 10,
      "applyTo": ["patterns"],
      "toneAdjustments": { "alert": 0.06 },
      "contextAdjustments": { "conflict": 0.08 },
      "attachmentAdjustments": { "anxious": 0.03 },
      "exceptions": ["genuine praise with positive valence nearby (e.g., 👍, 🙂, thanks, !!, 😊)","enthusiastic caps","multiple exclamation marks"]
    },
    {
      "id": "SARC_THANKS_FOR_NOTHING",
      "pattern": "\\bthanks\\s+for\\s+nothing\\b",
      "impact": -0.45,
      "description": "explicit sarcastic ‘thanks’",
      "scopeTokens": 8,
      "applyTo": ["patterns"],
      "toneAdjustments": { "alert": 0.16 },
      "contextAdjustments": { "conflict": 0.18 },
      "attachmentAdjustments": { "disorganized": 0.08 },
      "exceptions": []
    },
    {
      "id": "SARC_ELLIPSIS_TONE",
      "pattern": "\\.{3,}",
      "impact": -0.18,
      "description": "sardonic trailing ellipses",
      "scopeTokens": 6,
      "applyTo": ["features"],
      "toneAdjustments": { "caution": 0.06 },
      "contextAdjustments": { "conflict": 0.08, "repair": -0.04 },
      "attachmentAdjustments": {},
      "exceptions": ["quoted text","list truncation"]
    },
    {
      "id": "SARC_SLASH_S",
      "pattern": "\\s?/s\\b",
      "impact": -0.5,
      "description": "explicit sarcasm tag",
      "scopeTokens": 4,
      "applyTo": ["features"],
      "toneAdjustments": { "alert": -0.05, "caution": -0.05 },
      "contextAdjustments": { "conflict": 0.05, "repair": 0.05 },
      "attachmentAdjustments": {},
      "exceptions": []
    },
    {
      "id": "SARC_EYE_ROLL_EMOJI",
      "pattern": "[🙄😒]",
      "impact": -0.26,
      "description": "eye-roll/annoyance emoji",
      "scopeTokens": 5,
      "applyTo": ["features"],
      "toneAdjustments": { "alert": 0.08 },
      "contextAdjustments": { "conflict": 0.10 },
      "attachmentAdjustments": { "avoidant": 0.06 },
      "exceptions": ["light banter markers present (lol, 😅, 😉) within 6 tokens"]
    },
    {
      "id": "SARC_EXCESS_CAPS",
      "pattern": "\\b(OKAY|SURE|RIGHT)\\b",
      "impact": -0.15,
      "description": "sarcastic single-word caps",
      "scopeTokens": 4,
      "applyTo": ["features","patterns"],
      "toneAdjustments": { "alert": 0.06 },
      "contextAdjustments": { "conflict": 0.08 },
      "attachmentAdjustments": {},
      "exceptions": ["acronyms context","enthusiastic punctuation (!! or 😊)","thank you context","positive emoji nearby"]
    },
    {
      "id": "SARC_RHETORICAL_REALLY",
      "pattern": "\\boh\\s+really\\b|\\breally\\?$",
      "impact": -0.25,
      "description": "rhetorical ‘really’",
      "scopeTokens": 6,
      "applyTo": ["patterns"],
      "toneAdjustments": { "alert": 0.10 },
      "contextAdjustments": { "conflict": 0.12 },
      "attachmentAdjustments": {},
      "exceptions": []
    },
    {
      "id": "SARC_FAKE_POLITENESS",
      "pattern": "\\bthanks\\b.*\\b(i guess|whatever)\\b",
      "impact": -0.33,
      "description": "polite lead-in with dismissive tail",
      "scopeTokens": 14,
      "applyTo": ["patterns"],
      "toneAdjustments": { "alert": 0.12 },
      "contextAdjustments": { "conflict": 0.12, "validation": -0.06 },
      "attachmentAdjustments": { "anxious": 0.05 },
      "exceptions": []
    },
    {
      "id": "SARC_MULTI_PUNCT",
      "pattern": "[!?]{2,}|\\?!",
      "impact": -0.2,
      "description": " incredulous punctuation cluster ",
      "scopeTokens": 5,
      "applyTo": ["features"],
      "toneAdjustments": { "alert": 0.08 },
      "contextAdjustments": { "conflict": 0.10 },
      "attachmentAdjustments": {},
      "exceptions": []
    },
    {
      "id": "SARC_ML_ES_FR",
      "pattern": "(claro que sí|sí,\\s?como no|ya,\\s?claro|bien sûr|mais bien sûr)",
      "impact": -0.35,
      "description": "multilingual common sarcasm (ES/FR)",
      "scopeTokens": 10,
      "applyTo": ["patterns"],
      "toneAdjustments": { "alert": 0.12 },
      "contextAdjustments": { "conflict": 0.15 },
      "attachmentAdjustments": {},
      "exceptions": []
    }
  ],

  "post_processing": {
    "banter_soften_rule": {
      "if_present_within_tokens": 6,
      "markers": ["lol","jk","😉","😅","😂","lmao"],
      "dampen": 0.08
    },
    "quote_guard": {
      "if_within": "quote_block>direct",
      "reduce_impact": 0.20
    },
    "stacking_rule": {
      "max_stack": 3,
      "diminishing_return": 0.6
    }
  },

  "tests": [
    { "text": "Yeah right, \"great job\" 🙄", "expect": { "score>=:": 0.75, "triggers": ["SARC_YEAH_RIGHT","SARC_AIR_QUOTES","SARC_EYE_ROLL_EMOJI"] } },
    { "text": "Thanks for nothing.", "expect": { "score>=:": 0.70, "triggers": ["SARC_THANKS_FOR_NOTHING"] } },
    { "text": "Bien sûr…", "expect": { "score>=:": 0.65, "triggers": ["SARC_ML_ES_FR","SARC_ELLIPSIS_TONE"] } },
    { "text": "I’m quoting: “Great job.”", "expect": { "score<=:": 0.40 } },
    { "text": "Sure thing, happy to help!", "expect": { "score<=:": 0.40 } }
  ]
}
